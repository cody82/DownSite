<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <script src="/js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/ejs.js"></script>
    <script src="/js/crypto-js/sha1.js"></script>
    <style type="text/css">
html { height:100%; }
body { position:absolute; top:0; bottom:0; right:0; left:0; }
#images{ overflow:auto }
</style>
    <title></title>
</head>
<body>
	<script type="text/javascript">
	    function load_editor() {
	        $('#content').html("blabla");
	    }

	    function ejs_update(ejs_url, id, source_url) {
	        $.ajax({
	            type: "GET",
	            url: source_url,
	            //processData: false,
	            success: function (r) {
	                //callback(r);
	                new EJS({ url: ejs_url }).update(id, r);
	            }
	        });
	    }

	    function add_user() {
	        //var data = { "UserName": $('#input_name').val(), "Password": CryptoJS.SHA1($('#input_password').val()).toString(CryptoJS.enc.Hex) };
	        var data = { "UserName": $('#input_name').val(), "PlainTextPassword": $('#input_password').val() };
	        $.ajax({
	            type: "POST",
	            url: "/user",
	            processData: false,
	            contentType: 'application/json',
	            data: JSON.stringify(data),
	            success: function (r) {
	                //new EJS({ url: '/comments.ejs' }).update('element_id', '/Persons?format=json');
	                ejs_update('/comments.ejs', 'element_id', '/users?format=json');
	            }
	        });
	    }
	    function delete_user() {
	        var items = $('.delete').filter(function (x) { return this.checked; }).map(function () { return this.id; });
	        var count = items.length;
	        var i = 0;
	        items.each(function (index) {
	            $.ajax({
	                type: "DELETE",
	                url: "/users/" + this,
	                processData: false,
	                contentType: 'application/json',
	                data: "",
	                success: function (r) {
	                    i++;
	                    if (count == i) {
	                        //new EJS({ url: '/comments.ejs' }).update('element_id', '/Persons?format=json');
	                        ejs_update('/comments.ejs', 'element_id', '/users?format=json');
	                    }
	                }
	            });
	        });
	    }
	    $(document).ready(function () {
	        ejs_update('/comments.ejs', 'element_id', '/users?format=json');
	        //new EJS({ url: '/comments.ejs' }).update('element_id', '/Persons?format=json');
	    });
    </script>
    <a href="javascript:;" onclick="load_editor()">Editor</a>
    <a>Users</a>
    <div id="element_id">

    </div>
    
<input id="input_name" type="text"/>
<input id="input_password" type="text"/>
<a href="javascript:;" onclick="add_user()">add</a>
<a href="javascript:;" onclick="delete_user()">delete</a>

</body>
</html>